[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{% set print_format_name = frappe.db.get_value(\"Print Format\", {\"disabled\": 0, \"doc_type\": doc.doctype}, \"name\") %}\n{# 1. Get the POS Print Settings Document NAME #}\n{% set print_settings_result = frappe.db.get_list(\"POS Print Settings\", \n    filters={\"pos_profile\": doc.pos_profile},\n    fields=[\"name\"],\n    limit=1) \n%}\n\n{% set final_allowed_item_group = \"\" %}\n\n{% if print_settings_result %}\n    {% set pos_settings_name = print_settings_result[0].name %}\n    \n    {# 2. Fetch the ENTIRE POS Print Settings Doc object #}\n    {% set pos_settings_doc = frappe.get_doc(\"POS Print Settings\", pos_settings_name) %}\n    \n    {# 3. CRITICAL FIX: Use the 'select' filter to find the matching rule's item_group in a single safe expression #}\n    {% set matching_rule = pos_settings_doc.rules \n        | selectattr(\"restaurant_print_format\", \"equalto\", print_format_name) \n        | first \n    %}\n    \n    {% if matching_rule %}\n        {# 4. Assign the final item group safely #}\n        {% set final_allowed_item_group = matching_rule.item_group %}\n    {% endif %}\n\n{% endif %}\n\n{# --- TRACE START (Simplified for final deployment) --- #}\n<p style=\"color: blue; font-weight: bold;\">\n    --- TRACE START --- <br>\n    Final Allowed Item Group: {{ final_allowed_item_group | default('NOT FOUND') }} <br>\n    --- TRACE END ---\n</p>\n{# ------------------- #}\n\n<div style=\"text-align: center; font-family: Arial, sans-serif; font-size: 12px;\">\n    <h2>ظپط§طھظˆط±ط© ط§ظ„ظƒط§ط´ظٹط±</h2>\n    <p>ط±ظ‚ظ… ط§ظ„ظپط§طھظˆط±ط©: {{ doc.name }}</p>\n    <p>ط§ظ„طھط§ط±ظٹط®: {{ doc.posting_date }}</p>\n    <hr>\n    \n    <table style=\"width: 100%; font-size: 11px;\">\n        <thead>\n            <tr>\n                <th style=\"text-align: right;\">ط§ظ„طµظ†ظپ</th>\n                <th style=\"text-align: center;\">ط§ظ„ظƒظ…ظٹط©</th>\n                <th style=\"text-align: left;\">ط§ظ„ط³ط¹ط±</th>\n            </tr>\n        </thead>\n        <tbody>\n            {# FILTERING: Compares item's item_group to the final retrieved variable #}\n            {% for item in doc.items %}\n                {% if item.item_group == final_allowed_item_group %}\n                    <tr>\n                        <td style=\"text-align: right;\">{{ item.item_name }}</td>\n                        <td style=\"text-align: center;\">{{ item.qty }}</td>\n                        <td style=\"text-align: left;\">{{ item.rate }}</td>\n                    </tr>\n                {% endif %}\n            {% endfor %}\n        </tbody>\n    </table>\n    <hr>\n    <p style=\"text-align: left;\">ط§ظ„ظ…ط¬ظ…ظˆط¹ ط§ظ„ظƒظ„ظٹ ظ„ظ„ظپط§طھظˆط±ط©: {{ doc.grand_total }}</p>\n    <p style=\"text-align: center;\">ط´ظƒط±ط§ظ‹ ظ„طھط³ظˆظ‚ظƒظ… ظ…ط¹ظ†ط§!</p>\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-11-09 20:29:04.445235",
  "module": "Accounts",
  "name": "POS Cashier Format",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{# ====== DEBUG / TRACE (ط§ط®طھظٹط§ط±ظٹ ظ„ظ„طھط§ظ”ظƒط¯ ظ…ظ† ظˆطµظˆظ„ ط§ظ„ظ…طھط؛ظٹط±) ====== #}\r\n{% if doc.item_group %}\r\n<p style=\"color: blue; font-weight: bold; font-size: 10px;\">\r\n    ظ…ط¬ظ…ظˆط¹ط© ط§ظ„ط·ط¨ط§ط¹ط© ط§ظ„ظ…ط­ط¯ط¯ط©: {{ doc.item_group }}\r\n</p>\r\n{% endif %}\r\n\r\n{# ====== HEADER ====== #}\r\n<div style=\"text-align: center; font-family: 'Cairo', Arial, sans-serif; font-size: 12px; direction: rtl;\">\r\n    <h2 style=\"margin: 0; padding: 0;\">ظپط§طھظˆط±ط© ط§ظ„ظƒط§ط´ظٹط±</h2>\r\n    <p style=\"margin: 2px 0;\">ط±ظ‚ظ… ط§ظ„ظپط§طھظˆط±ط©: {{ doc.name }}</p>\r\n    <p style=\"margin: 2px 0;\">ط§ظ„طھط§ط±ظٹط®: {{ frappe.format(doc.posting_date, {'fieldtype': 'Date'}) }}</p>\r\n    <hr style=\"border: 1px solid #000;\">\r\n</div>\r\n\r\n{# ====== ITEMS TABLE ====== #}\r\n<table style=\"width: 100%; border-collapse: collapse; font-size: 11px; font-family: 'Cairo', sans-serif; direction: rtl;\">\r\n    <thead>\r\n        <tr style=\"background-color: #f0f0f0; border-bottom: 1px solid #000;\">\r\n            <th style=\"text-align: right; padding: 4px;\">ط§ظ„طµظ†ظپ</th>\r\n            <th style=\"text-align: center; padding: 4px;\">ط§ظ„ظƒظ…ظٹط©</th>\r\n            <th style=\"text-align: left; padding: 4px;\">ط§ظ„ط³ط¹ط±</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        {% set found = false %}\r\n        {% for item in doc.items %}\r\n            {% if not doc.item_group or item.item_group == doc.item_group %}\r\n                {% set found = true %}\r\n                <tr>\r\n                    <td style=\"text-align: right; padding: 3px;\">{{ item.item_name }}</td>\r\n                    <td style=\"text-align: center; padding: 3px;\">{{ item.qty | round(2) }}</td>\r\n                    <td style=\"text-align: left; padding: 3px;\">{{ item.rate | round(2) }}</td>\r\n                </tr>\r\n            {% endif %}\r\n        {% endfor %}\r\n\r\n        {% if not found %}\r\n            <tr>\r\n                <td colspan=\"3\" style=\"text-align: center; padding: 6px; color: gray;\">\r\n                    ظ„ط§ طھظˆط¬ط¯ ط£طµظ†ط§ظپ ظپظٹ ظ…ط¬ظ…ظˆط¹ط© <b>{{ doc.item_group }}</b>\r\n                </td>\r\n            </tr>\r\n        {% endif %}\r\n    </tbody>\r\n</table>\r\n\r\n<hr style=\"border: 1px solid #000; margin-top: 6px;\">\r\n\r\n{# ====== FOOTER ====== #}\r\n<div style=\"font-family: 'Cairo', sans-serif; font-size: 12px; direction: rtl;\">\r\n    <p style=\"text-align: left; font-weight: bold;\">\r\n        ط§ظ„ظ…ط¬ظ…ظˆط¹ ط§ظ„ظƒظ„ظٹ ظ„ظ„ظپط§طھظˆط±ط©: {{ frappe.format(doc.grand_total, {'fieldtype': 'Currency'}) }}\r\n    </p>\r\n    <p style=\"text-align: center; margin-top: 8px;\">ط´ظƒط±ط§ظ‹ ظ„طھط³ظˆظ‚ظƒظ… ظ…ط¹ظ†ط§!</p>\r\n</div>\r\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-11-13 03:22:32.145605",
  "module": "Accounts",
  "name": "POS Kitchen Format",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<div style=\"text-align: center; font-family: Arial, sans-serif; font-size: 12px;\">\r\n    <h3>ط£ظˆط§ظ…ط± ط§ظ„ط¹طµط§ط¦ط±</h3>\r\n    <p>ط±ظ‚ظ… ط§ظ„ظپط§طھظˆط±ط©: {{ doc.name }}</p>\r\n    <hr>\r\n    <table style=\"width: 100%; font-size: 11px;\">\r\n        <thead>\r\n            <tr>\r\n                <th style=\"text-align: right;\">ط§ظ„ظ…ط´ط±ظˆط¨</th>\r\n                <th style=\"text-align: center;\">ط§ظ„ظƒظ…ظٹط©</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            {% for item in doc.items %}\r\n            {% if \"ط¹طµظٹط±\" in item.item_name or \"ظ…ط´ط±ظˆط¨\" in item.item_name %}\r\n            <tr>\r\n                <td style=\"text-align: right;\">{{ item.item_name }}</td>\r\n                <td style=\"text-align: center;\">{{ item.qty }}</td>\r\n            </tr>\r\n            {% endif %}\r\n            {% endfor %}\r\n        </tbody>\r\n    </table>\r\n    <hr>\r\n    <p style=\"text-align: center;\">ظٹط±ط¬ظ‰ طھط¬ظ‡ظٹط² ط§ظ„ط¹طµط§ط¦ط± ظˆط§ظ„ظ…ط´ط±ظˆط¨ط§طھ!</p>\r\n</div>\r\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-09-22 04:27:10.160976",
  "module": "Accounts",
  "name": "POS Juice Format",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{% set print_format_name = frappe.db.get_value(\"Print Format\", {\"disabled\": 0, \"doc_type\": doc.doctype}, \"name\") %}\n{% set print_settings_result = frappe.db.get_list(\"POS Print Settings\", \n    filters={\"pos_profile\": doc.pos_profile},\n    fields=[\"name\"],\n    limit=1) \n%}\n\n{% set final_allowed_item_group = \"\" %}\n{% set print_price_enabled = True %}\n{% set bill_title = \"ظپط§طھظˆط±ط© ط§ظ„ظƒط§ط´ظٹط±\" %}\n\n{% if print_settings_result %}\n    {% set pos_settings_name = print_settings_result[0].name %}\n    {% set pos_settings_doc = frappe.get_doc(\"POS Print Settings\", pos_settings_name) %}\n    \n    {% set matching_rule = pos_settings_doc.rules \n        | selectattr(\"restaurant_print_format\", \"equalto\", print_format_name) \n        | first \n    %}\n    \n    {% if matching_rule %}\n        {% set final_allowed_item_group = matching_rule.item_group %}\n        {% set bill_title = matching_rule.btitle %}\n        {% set print_price_enabled = matching_rule.print_price %}\n    {% endif %}\n{% endif %}\n\n<div style=\"text-align: center; font-family: Arial, sans-serif; font-size: 12px;\">\n    <h2>{{ bill_title }}</h2>\n    <p>ط±ظ‚ظ… ط§ظ„ظپط§طھظˆط±ط©: {{ doc.name }}</p>\n    <p>ط§ظ„طھط§ط±ظٹط®: {{ doc.posting_date }}</p>\n    <hr>\n    \n    <table style=\"width: 100%; font-size: 11px;\">\n        <thead>\n            <tr>\n                <th style=\"text-align: right;\">ط§ظ„طµظ†ظپ</th>\n                <th style=\"text-align: center;\">ط§ظ„ظƒظ…ظٹط©</th>\n                {% if print_price_enabled %}\n                    <th style=\"text-align: left;\">ط§ظ„ط³ط¹ط±</th>\n                {% endif %}\n            </tr>\n        </thead>\n        <tbody>\n            {% for item in doc.items %}\n                {% if item.item_group == final_allowed_item_group %}\n                    <tr>\n                        <td style=\"text-align: right;\">{{ item.item_name }}</td>\n                        <td style=\"text-align: center;\">{{ item.qty }}</td>\n                        {% if print_price_enabled %}\n                            <td style=\"text-align: left;\">{{ item.rate }}</td>\n                        {% endif %}\n                    </tr>\n                {% endif %}\n            {% endfor %}\n        </tbody>\n    </table>\n    <hr>\n    {% if print_price_enabled %}\n        <p style=\"text-align: left;\">ط§ظ„ظ…ط¬ظ…ظˆط¹ ط§ظ„ظƒظ„ظٹ ظ„ظ„ظپط§طھظˆط±ط©: {{ doc.grand_total }}</p>\n    {% endif %}\n    <p style=\"text-align: center;\">ط´ظƒط±ط§ظ‹ ظ„طھط³ظˆظ‚ظƒظ… ظ…ط¹ظ†ط§!</p>\n</div>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-11-14 00:29:30.062962",
  "module": "Accounts",
  "name": "POS Print",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]
