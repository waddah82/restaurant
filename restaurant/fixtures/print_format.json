[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{% set print_format_name = frappe.db.get_value(\"Print Format\", {\"disabled\": 0, \"doc_type\": doc.doctype}, \"name\") %}\n{# 1. Get the POS Print Settings Document NAME #}\n{% set print_settings_result = frappe.db.get_list(\"POS Print Settings\", \n    filters={\"pos_profile\": doc.pos_profile},\n    fields=[\"name\"],\n    limit=1) \n%}\n\n{% set final_allowed_item_group = \"\" %}\n\n{% if print_settings_result %}\n    {% set pos_settings_name = print_settings_result[0].name %}\n    \n    {# 2. Fetch the ENTIRE POS Print Settings Doc object #}\n    {% set pos_settings_doc = frappe.get_doc(\"POS Print Settings\", pos_settings_name) %}\n    \n    {# 3. CRITICAL FIX: Use the 'select' filter to find the matching rule's item_group in a single safe expression #}\n    {% set matching_rule = pos_settings_doc.rules \n        | selectattr(\"restaurant_print_format\", \"equalto\", print_format_name) \n        | first \n    %}\n    \n    {% if matching_rule %}\n        {# 4. Assign the final item group safely #}\n        {% set final_allowed_item_group = matching_rule.item_group %}\n    {% endif %}\n\n{% endif %}\n\n{# --- TRACE START (Simplified for final deployment) --- #}\n<p style=\"color: blue; font-weight: bold;\">\n    --- TRACE START --- <br>\n    Final Allowed Item Group: {{ final_allowed_item_group | default('NOT FOUND') }} <br>\n    --- TRACE END ---\n</p>\n{# ------------------- #}\n\n<div style=\"text-align: center; font-family: Arial, sans-serif; font-size: 12px;\">\n    <h2>فاتورة الكاشير</h2>\n    <p>رقم الفاتورة: {{ doc.name }}</p>\n    <p>التاريخ: {{ doc.posting_date }}</p>\n    <hr>\n    \n    <table style=\"width: 100%; font-size: 11px;\">\n        <thead>\n            <tr>\n                <th style=\"text-align: right;\">الصنف</th>\n                <th style=\"text-align: center;\">الكمية</th>\n                <th style=\"text-align: left;\">السعر</th>\n            </tr>\n        </thead>\n        <tbody>\n            {# FILTERING: Compares item's item_group to the final retrieved variable #}\n            {% for item in doc.items %}\n                {% if item.item_group == final_allowed_item_group %}\n                    <tr>\n                        <td style=\"text-align: right;\">{{ item.item_name }}</td>\n                        <td style=\"text-align: center;\">{{ item.qty }}</td>\n                        <td style=\"text-align: left;\">{{ item.rate }}</td>\n                    </tr>\n                {% endif %}\n            {% endfor %}\n        </tbody>\n    </table>\n    <hr>\n    <p style=\"text-align: left;\">المجموع الكلي للفاتورة: {{ doc.grand_total }}</p>\n    <p style=\"text-align: center;\">شكراً لتسوقكم معنا!</p>\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-11-09 20:29:04.445235",
  "module": "Accounts",
  "name": "POS Cashier Format",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<div style=\"text-align: center; font-family: Arial, sans-serif; font-size: 12px;\">\r\n    <h3>أوامر المطبخ</h3>\r\n    <p>رقم الفاتورة: {{ doc.name }}</p>\r\n    <hr>\r\n    <table style=\"width: 100%; font-size: 11px;\">\r\n        <thead>\r\n            <tr>\r\n                <th style=\"text-align: right;\">الصنف</th>\r\n                <th style=\"text-align: center;\">الكمية</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            {% for item in doc.items %}\r\n            <tr>\r\n                <td style=\"text-align: right;\">{{ item.item_name }}</td>\r\n                <td style=\"text-align: center;\">{{ item.qty }}</td>\r\n            </tr>\r\n            {% endfor %}\r\n        </tbody>\r\n    </table>\r\n    <hr>\r\n    <p style=\"text-align: center;\">يرجى تجهيز الطلب بسرعة!</p>\r\n</div>\r\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-09-22 04:26:23.578875",
  "module": "Accounts",
  "name": "POS Kitchen Format",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "POS Invoice",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<div style=\"text-align: center; font-family: Arial, sans-serif; font-size: 12px;\">\r\n    <h3>أوامر العصائر</h3>\r\n    <p>رقم الفاتورة: {{ doc.name }}</p>\r\n    <hr>\r\n    <table style=\"width: 100%; font-size: 11px;\">\r\n        <thead>\r\n            <tr>\r\n                <th style=\"text-align: right;\">المشروب</th>\r\n                <th style=\"text-align: center;\">الكمية</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            {% for item in doc.items %}\r\n            {% if \"عصير\" in item.item_name or \"مشروب\" in item.item_name %}\r\n            <tr>\r\n                <td style=\"text-align: right;\">{{ item.item_name }}</td>\r\n                <td style=\"text-align: center;\">{{ item.qty }}</td>\r\n            </tr>\r\n            {% endif %}\r\n            {% endfor %}\r\n        </tbody>\r\n    </table>\r\n    <hr>\r\n    <p style=\"text-align: center;\">يرجى تجهيز العصائر والمشروبات!</p>\r\n</div>\r\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-09-22 04:27:10.160976",
  "module": "Accounts",
  "name": "POS Juice Format",
  "page_number": "Hide",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]
